!function(e){"use strict";var t=function(){function e(e,t){for(var a in t){var n=t[a];n.configurable=!0,n.value&&(n.writable=!0)}Object.defineProperties(e,t)}return function(t,a,n){return a&&e(t.prototype,a),n&&e(t,n),t}}(),a=function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")},n=function(e){var l=e.fn.wysiwyg,o={toolbar:[["mode"],["styles"],["fonts",["select","size"]],["text",["bold","italic","underline","color"]],["align",["left","center","right","justify"]],["lists",["default","numeric","level-indent","level-outdent"]],["components",["table","chart"]],["props",["interval","line-height","letter-spacing"]],["insert",["emoji","link","image","video","symbol","bookmark"]],["special",["print","clean"]],["fullscreen"]],mode:"editor",fontSizes:["8px","9px","10px","11px","12px","13px","14px","15px","16px","17px","18px"],fontSizeDefault:["12px"],fontFamilies:["Open Sans","Arial","Arial Black","Courier","Courier New","Comic Sans MS","Helvetica","Impact","Lucida Grande","Lucida Sans","Tahoma","Times","Times New Roman","Verdana"],fontFamilyDefault:["Open Sans"]},i=function(){function l(t,n){var i=this;a(i,l),i._config=e.extend({},o,n),i._editorId="wysiwyg-"+(String.fromCharCode(Math.floor(11*Math.random()))+Math.floor(1e6*Math.random())).trim(),i._$element=t instanceof jQuery?t:e(t),i._inputId=i._$element.attr("id"),i._$editor=e('<div id="'+i._editorId+'" aria-describedby="#'+i._inputId+'" class="wysiwyg-editor" />'),i._$element.wrap(i._$editor),i._$content=e('<div class="editor-content" contenteditable="true" />'),i._$content.html(i._$element.val()),i._$element.before(i._$content),i._source=i._$element.val(),i._$toolbar=e('<div class="wysiwyg-toolbar btn-toolbar" />'),i._$content.before(i._$toolbar),i._$statusbar=e('<div class="editor-statusbar" />'),i._$statusbar.stat=e('<span class="editor-statusbar-stat" />'),i._$statusbar.path=e('<span class="editor-statusbar-path" />'),i._$statusbar.append(i._$statusbar.stat),i._$statusbar.append(i._$statusbar.path),i._$content.after(i._$statusbar),i._$element.addClass("hide"),"object"==typeof i._config.toolbar&&e.each(i._config.toolbar,function(t,a){var n=e('<div class="btn-group" role="group" aria-label="..." />');if("mode"===a[0])n.append(i._buildTollbarButton("mode","editor","fa fa-eye",null)),n.append(i._buildTollbarButton("mode","source","fa fa-code",null));else if("styles"===a[0]){n.append(i._buildTollbarDropdown("select-style",{"Header H1":{action:"wrap",value:"<h1 />"},"Header H2":{action:"wrap",value:"<h2 />"},"Header H3":{action:"wrap",value:"<h3 />"}},"fa fa-header","Style"))}else if("fonts"===a[0]){if(-1!==a[1].indexOf("select",0)){var l={};e.each(i._config.fontFamilies,function(e,t){l[t]={action:"style",value:"font-family:'"+t+"';"}}),n.append(i._buildTollbarDropdown("font-select",l,"fa fa-underline",i._config.fontFamilyDefault))}if(-1!==a[1].indexOf("size",0)){var o={};e.each(i._config.fontSizes,function(e,t){o[t]={action:"style",value:"font-size: "+t+";"}}),n.append(i._buildTollbarDropdown("font-size",o,null,i._config.fontSizeDefault))}n.append(i._buildTollbarDropdown("font-size",["test1","test2","test3","test4","test5"],"fa fa-underline","test3"))}else"text"===a[0]?(-1!==a[1].indexOf("bold",0)&&n.append(i._buildTollbarButton("text","bold","fa fa-bold",null)),-1!==a[1].indexOf("italic",0)&&n.append(i._buildTollbarButton("text","italic","fa fa-italic",null)),-1!==a[1].indexOf("underline",0)&&n.append(i._buildTollbarButton("text","underline","fa fa-underline",null)),-1!==a[1].indexOf("color",0)&&n.append(i._buildTollbarButton("text","color","fa fa-font",null))):"align"===a[0]?(-1!==a[1].indexOf("left",0)&&n.append(i._buildTollbarButton("align","left","fa fa-align-left",null)),-1!==a[1].indexOf("center",0)&&n.append(i._buildTollbarButton("align","center","fa fa-align-center",null)),-1!==a[1].indexOf("right",0)&&n.append(i._buildTollbarButton("align","right","fa fa-align-right",null)),-1!==a[1].indexOf("justify",0)&&n.append(i._buildTollbarButton("align","justify","fa fa-align-justify",null))):"lists"===a[0]?(-1!==a[1].indexOf("default",0)&&n.append(i._buildTollbarButton("lists","default","fa fa-list-ul",null)),-1!==a[1].indexOf("numeric",0)&&n.append(i._buildTollbarButton("lists","numeric","fa fa-list-ol",null)),-1!==a[1].indexOf("level-indent",0)&&n.append(i._buildTollbarButton("lists","level-indent","fa fa-indent",null)),-1!==a[1].indexOf("level-outdent",0)&&n.append(i._buildTollbarButton("lists","level-outdent","fa fa-outdent",null))):"components"===a[0]?(-1!==a[1].indexOf("table",0)&&n.append(i._buildTollbarButton("components","table","fa fa-table",null)),-1!==a[1].indexOf("chart",0)&&n.append(i._buildTollbarButton("components","chart","fa fa-pie-chart",null))):"props"===a[0]?(-1!==a[1].indexOf("interval",0)&&n.append(i._buildTollbarButton("props","interval","fa fa-bars",null)),-1!==a[1].indexOf("line-height",0)&&n.append(i._buildTollbarButton("props","line-height","fa fa-text-height",null)),-1!==a[1].indexOf("letter-spacing",0)&&n.append(i._buildTollbarButton("props","letter-spacing","fa fa-text-width",null))):"insert"===a[0]?(-1!==a[1].indexOf("emoji",0)&&n.append(i._buildTollbarButton("insert","emoji","fa fa-smile-o",null)),-1!==a[1].indexOf("link",0)&&n.append(i._buildTollbarButton("insert","link","fa fa-link",null)),-1!==a[1].indexOf("image",0)&&n.append(i._buildTollbarButton("insert","image","fa fa-image",null)),-1!==a[1].indexOf("video",0)&&n.append(i._buildTollbarButton("insert","video","fa fa-video-camera",null)),-1!==a[1].indexOf("symbol",0)&&n.append(i._buildTollbarButton("insert","symbol","fa fa-hashtag",null)),-1!==a[1].indexOf("bookmark",0)&&n.append(i._buildTollbarButton("insert","bookmark","fa fa-bookmark",null))):"special"===a[0]?(-1!==a[1].indexOf("print",0)&&n.append(i._buildTollbarButton("special","print","fa fa-print",null)),-1!==a[1].indexOf("clean",0)&&n.append(i._buildTollbarButton("special","clean","fa fa-eraser",null))):"fullscreen"===a[0]&&(n.addClass("pull-right"),n.append(i._buildTollbarButton("fullscreen",!0,"fa fa-arrows-alt",null)));i._$toolbar.append(n)}),i._$toolbar.length&&i._$toolbar.on("click","[data-action]",function(t){var a=e(t.currentTarget),n=a.data("action"),l=a.data("value");if(n&&l)switch(n){case"mode":switch(l){case"editor":i._config.mode!==l&&(i._config.mode=l,i._$content.html(i._source),i._$toolbar.find('[data-action="mode"]').removeClass("active"),i._$toolbar.find('[data-action="mode"][data-value="editor"]').addClass("active"),i._$content.addClass("editor-mode").removeClass("source-mode"),i._$content.focus());break;case"source":if(i._config.mode!==l){i._config.mode=l,i._source=i._$content.html();var o=e("<pre />");o.text(i._source),i._$content.html(i._trimSource(o.html())),i._$toolbar.find('[data-action="mode"]').removeClass("active"),i._$toolbar.find('[data-action="mode"][data-value="source"]').addClass("active"),i._$content.removeClass("editor-mode").addClass("source-mode"),i._$content.focus()}}break;case"wrap":case"style":case"fullscreen":console.log("Fire action: "+n+" with value: "+l);break;case"text":switch(l){case"bold":case"italic":case"underline":case"color":console.log("Fire action: "+n+" with value: "+l)}break;case"align":switch(l){case"left":case"center":case"right":case"justify":console.log("Fire action: "+n+" with value: "+l)}break;case"lists":switch(l){case"default":case"numeric":case"level-indent":case"level-outdent":console.log("Fire action: "+n+" with value: "+l)}break;case"components":switch(l){case"table":case"chart":console.log("Fire action: "+n+" with value: "+l)}break;case"props":switch(l){case"interval":case"line-height":case"letter-spacing":console.log("Fire action: "+n+" with value: "+l)}break;case"insert":switch(l){case"emoji":case"link":case"image":case"video":case"symbol":case"bookmark":console.log("Fire action: "+n+" with value: "+l)}break;case"special":switch(l){case"print":case"clean":console.log("Fire action: "+n+" with value: "+l)}break;default:console.warn("Unrecognized action: "+n+" with value: "+l)}}),i._$content.on("mouseup keyup",function(e){window.getSelection()}),i._$content.on("click keyup",function(t){const a=e(this);window.getSelection();var n=e(t.target);if("editor"==i._config.mode){var l=i._getTextStat(i._$content.get(0)),o=i._getPath(n,i._$content);switch(o.tags[0]){case"b":i._$toolbar.find('[data-action="text"]').removeClass("active"),i._$toolbar.find('[data-action="text"][data-value="bold"]').addClass("active");break;case"u":i._$toolbar.find('[data-action="text"]').removeClass("active"),i._$toolbar.find('[data-action="text"][data-value="underline"]').addClass("active");break;case"i":i._$toolbar.find('[data-action="text"]').removeClass("active"),i._$toolbar.find('[data-action="text"][data-value="italic"]').addClass("active");break;case"a":i._$toolbar.find('[data-action="insert"]').removeClass("active"),i._$toolbar.find('[data-action="insert"][data-value="link"]').addClass("active");break;case"p":i._$toolbar.find('[data-action="align"]').removeClass("active"),"center"==n.css("text-align")?i._$toolbar.find('[data-action="align"][data-value="center"]').addClass("active"):"right"==n.css("text-align")?i._$toolbar.find('[data-action="align"][data-value="right"]').addClass("active"):"justify"==n.css("text-align")?i._$toolbar.find('[data-action="align"][data-value="justify"]').addClass("active"):i._$toolbar.find('[data-action="align"][data-value="left"]').addClass("active");break;default:i._$toolbar.find('[data-action="insert"]').removeClass("active")}i._$statusbar.path.text(o.path),i._$statusbar.stat.text("Words: "+l.words+", length: "+l.length)}else{var r=i._getTextPosition(i._$content.get(0));i._$statusbar.path.empty(),i._$statusbar.stat.text("Line: "+r.line+", column: "+r.end),console.log(r)}a.trigger("change")}),i._$content.on("change",function(t){const a=e(this);"editor"==i._config.mode?i._source=a.html():i._source=a.text(),i._$element.val(i._source)}),i._$element.on("click keyup",function(t){e(this);var a=i._getTextPosition(i._$element.get(0));console.log(a)})}return t(l,{element:{value:function(){return this._$element}},_trimSource:{value:function(e){return e=(e=(e=e.replace(/\s{4,}/g,"")).replace(/\t/g," ")).toString().trim().replace(/(\r\n|\n|\r)/g,"")}},_getPath:{value:function(t,a){for(var n,l=[];t.length;){var o=t[0],i=o.localName,r=t.parentsUntil(a);if(!i)break;i=i.toLowerCase(),l.push(i);var s=e(o).attr("id");s&&(i+="#"+s);var c=e(o).attr("class");c&&(i+="."+c.replace(/\./g,".")),n=i+(n?" > "+n:""),t=r}return{path:n,tags:l}}},_getTextStat:{value:function(e){var t;return{words:(t=e&&e.contentEditable?e.innerText.replace(/\r\n/g,"\n"):e.value.replace(/\r\n/g,"\n")).split(" ").length,length:t.length}}},_getTextPosition:{value:function(e){var t,a,n,l,o,i=0,r=0,s=0,c=e&&e.contentEditable;return"selectionStart"in e&&document.activeElement==e?(r=e.selectionStart,s=e.selectionEnd,i=(t=e.value.replace(/\r\n/g,"\n")).substr(0,e.selectionStart).split("\n").length):c?(r=window.getSelection().getRangeAt(0).startOffset,s=window.getSelection().getRangeAt(0).endOffset,0==(i=(t=e.innerText.replace(/\r\n/g,"\n")).substr(0,e.selectionStart).split("\n").length-1)&&(i=1)):(a=document.selection.createRange())&&a.parentElement()==e&&(l=e.value.length,t=e.value.replace(/\r\n/g,"\n"),(n=e.createTextRange()).moveToBookmark(a.getBookmark()),(o=e.createTextRange()).collapse(!1),n.compareEndPoints("StartToEnd",o)>-1?r=s=l:(r=-n.moveStart("character",-l),r+=t.slice(0,r).split("\n").length-1,n.compareEndPoints("EndToEnd",o)>-1?s=l:(s=-n.moveEnd("character",-l),s+=t.slice(0,s).split("\n").length-1))),{line:i,start:r,end:s}}},_insertText:{value:function(e){document.execCommand("insertText",!1,e)}},_buildTollbarButton:{value:function(t,a,n,l){var o=e('<button type="button" class="btn btn-default" tabindex="-1" />');return t&&o.attr("data-action",t),a&&o.attr("data-value",a),l&&o.attr("data-hotkey",l),n&&o.append('<span class="'+n+'" />'),o}},_buildTollbarDropdown:{value:function(t,a,n,l){var o=e('<div class="dropdown" />'),i=e('<button type="button" class="btn btn-default dropdown-toggle" data-toggle="dropdown" />'),r=e('<ul class="dropdown-menu" />'),s=e("<li />"),c=e('<a href="#" tabindex="-1" />');return"object"==typeof a&&e.each(a,function(a,n){var o=c.clone(),i=s.clone();"object"==typeof n?(n.action&&o.attr("data-action",n.action),n.value&&o.attr("data-value",n.value),"wrap"==n.action?o.html(e(n.value).text(a)):o.text(a),"style"==n.action&&o.attr("style",n.value.toString()),a==l&&i.addClass("active"),i.append(o),r.append(i)):(o.text(n),o.attr("data-action",t),o.attr("data-value",n),n==l&&i.addClass("active"),i.append(o),r.append(i))}),n&&i.prepend('<span class="'+n+'" /> '),l?i.text(l+" "):i.text("Dropdown "),i.append('<b class="caret" />'),o.append(i),o.append(r),o}}},{Default:{get:function(){return o}},_jQueryInterface:{value:function(t){var a=this;return t=t||{},a.each(function(){var o=e(a),i=e.extend({},n.Default,o.data(),"object"==typeof t&&t);new l(a,i)})}}}),l}();return e.fn.wysiwyg=i._jQueryInterface,e.fn.wysiwyg.Constructor=i,e.fn.wysiwyg.noConflict=function(){return e.fn.wysiwyg=l,i._jQueryInterface},i}(jQuery)}(jQuery);
//# sourceMappingURL=wysiwyg.js.map